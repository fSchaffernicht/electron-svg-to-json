{"ast":null,"code":"'use strict';\n\nexports.type = 'perItemReverse';\nexports.active = true;\nexports.description = 'collapses useless groups';\n\nvar animationElems = require('./_collections').elemsGroups.animation;\n\nfunction hasAnimatedAttr(item) {\n  return item.isElem(animationElems) && item.hasAttr('attributeName', this) || !item.isEmpty() && item.content.some(hasAnimatedAttr, this);\n}\n/*\n * Collapse useless groups.\n *\n * @example\n * <g>\n *     <g attr1=\"val1\">\n *         <path d=\"...\"/>\n *     </g>\n * </g>\n *         ⬇\n * <g>\n *     <g>\n *         <path attr1=\"val1\" d=\"...\"/>\n *     </g>\n * </g>\n *         ⬇\n * <path attr1=\"val1\" d=\"...\"/>\n *\n * @param {Object} item current iteration item\n * @return {Boolean} if false, item will be filtered out\n *\n * @author Kir Belevich\n */\n\n\nexports.fn = function (item) {\n  // non-empty elements\n  if (item.isElem() && !item.isElem('switch') && !item.isEmpty()) {\n    item.content.forEach(function (g, i) {\n      // non-empty groups\n      if (g.isElem('g') && !g.isEmpty()) {\n        // move group attibutes to the single content element\n        if (g.hasAttr() && g.content.length === 1) {\n          var inner = g.content[0];\n\n          if (inner.isElem() && !inner.hasAttr('id') && (!g.hasAttr('clip-path') || inner.isElem('g') && !g.hasAttr('transform') && !inner.hasAttr('transform'))) {\n            g.eachAttr(function (attr) {\n              if (g.content.some(hasAnimatedAttr, attr.name)) return;\n\n              if (!inner.hasAttr(attr.name)) {\n                inner.addAttr(attr);\n              } else if (attr.name == 'transform' || attr.name == 'class') {\n                inner.attr(attr.name).value = attr.value + ' ' + inner.attr(attr.name).value;\n              }\n\n              g.removeAttr(attr.name);\n            });\n          }\n        } // collapse groups without attributes\n\n\n        if (!g.hasAttr() && !g.content.some(function (item) {\n          return item.isElem(animationElems);\n        })) {\n          item.spliceContent(i, 1, g.content);\n        }\n      }\n    });\n  }\n};","map":null,"metadata":{},"sourceType":"script"}